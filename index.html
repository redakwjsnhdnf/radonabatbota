<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>REDA MEGA PROJECT - Phase 8</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; color: #0f0; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 1px solid #0f0; z-index: 10; }
        #shop-ui { position: absolute; top: 50%; right: 20px; transform: translateY(-50%); background: rgba(0,0,0,0.9); padding: 20px; border: 2px solid #ffcc00; color: #fff; border-radius: 10px; display: none; z-index: 100; }
        button { background: #ffcc00; border: none; padding: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; width: 100%; }
        #shop-btn { position: absolute; bottom: 20px; right: 20px; padding: 15px; background: #ffcc00; border-radius: 50%; cursor: pointer; font-weight: bold; z-index: 10; border: none; }
    </style>
</head>
<body>
    <div id="ui">
        <b>REDA WORLD: MEGA PROJECT</b><br>
        Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠØ©: <span id="total-kills">0</span><br>
        Ø§Ù„Ø³Ù„Ø§Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="weapon-name">Ø®Ù†Ø¬Ø± Ø¨Ø³ÙŠØ·</span>
    </div>

    <button id="shop-btn" onclick="toggleShop()">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>

    <div id="shop-ui">
        <h3>Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø³Ù„Ø­Ø©</h3>
        <p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 10</p>
        <button onclick="buyWeapon('Ø³ÙŠÙ Ø§Ù„Ù†ÙŠÙˆÙ†', 0x00ffff, 10)">Ø´Ø±Ø§Ø¡ Ø³ÙŠÙ Ø§Ù„Ù†ÙŠÙˆÙ†</button>
        <button onclick="toggleShop()" style="background:#555">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­ÙØ¸ ---
        let totalKills = localStorage.getItem('reda_kills') ? parseInt(localStorage.getItem('reda_kills')) : 0;
        let currentWeaponColor = 0xcccccc;

        window.onload = () => {
            document.getElementById('total-kills').innerText = totalKills;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x020205);
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.GridHelper(200, 50, 0x444444, 0x222222));
            scene.add(new THREE.AmbientLight(0x404040));

            // Ø§Ù„Ù„Ø§Ø¹Ø¨
            const player = new THREE.Group();
            const pBody = new THREE.Mesh(new THREE.BoxGeometry(0.6, 1.5, 0.4), new THREE.MeshPhongMaterial({color: 0x0066ff}));
            pBody.position.y = 0.75;
            player.add(pBody);

            // Ø§Ù„Ø³ÙŠÙ
            let sword = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 1.2), new THREE.MeshPhongMaterial({color: currentWeaponColor}));
            sword.position.set(0.4, 0.8, -0.6);
            player.add(sword);
            scene.add(player);

            // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ¬Ø±
            window.toggleShop = () => {
                const shop = document.getElementById('shop-ui');
                shop.style.display = shop.style.display === 'none' ? 'block' : 'none';
            };

            window.buyWeapon = (name, color, price) => {
                if(totalKills >= price) {
                    totalKills -= price;
                    localStorage.setItem('reda_kills', totalKills);
                    document.getElementById('total-kills').innerText = totalKills;
                    sword.material.color.setHex(color);
                    document.getElementById('weapon-name').innerText = name;
                    alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!");
                } else {
                    alert("Ù†Ù‚Ø§Ø·Ùƒ Ù„Ø§ ØªÙƒÙÙŠ!");
                }
            };

            let enemies = [];
            function spawnEnemy() {
                const enemy = new THREE.Mesh(new THREE.BoxGeometry(1, 1, 1), new THREE.MeshPhongMaterial({color: 0xff0055}));
                enemy.position.set(Math.random()*60-30, 0.5, Math.random()*60-30);
                scene.add(enemy);
                enemies.push(enemy);
            }
            for(let i=0; i<8; i++) spawnEnemy();

            window.onclick = (e) => {
                if(e.target.tagName === 'CANVAS') {
                    sword.rotation.x = -Math.PI / 3;
                    setTimeout(() => sword.rotation.x = 0, 100);
                    
                    enemies.forEach((enemy, index) => {
                        if(player.position.distanceTo(enemy.position) < 4) {
                            scene.remove(enemy);
                            enemies.splice(index, 1);
                            totalKills++;
                            localStorage.setItem('reda_kills', totalKills);
                            document.getElementById('total-kills').innerText = totalKills;
                            spawnEnemy();
                        }
                    });
                }
            };

            const keys = {};
            window.onkeydown = (e) => keys[e.code] = true;
            window.onkeyup = (e) => keys[e.code] = false;

            function animate() {
                requestAnimationFrame(animate);
                if (keys['KeyW']) player.translateZ(-0.2);
                if (keys['KeyS']) player.translateZ(0.2);
                if (keys['KeyA']) player.rotation.y += 0.05;
                if (keys['KeyD']) player.rotation.y -= 0.05;

                const offset = new THREE.Vector3(0, 5, 10).applyMatrix4(player.matrixWorld);
                camera.position.lerp(offset, 0.1);
                camera.lookAt(player.position.x, player.position.y + 1, player.position.z);
                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
