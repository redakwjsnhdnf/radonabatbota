<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Void Sentinel: Ultra Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #010103; cursor: none; }
        #ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; border: 40px solid rgba(0,0,0,0.4); box-sizing: border-box;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
        }
    </style>
</head>
<body>

<div id="ui-overlay"></div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;

let frame = 0;
const keys = {};

// --- نظام الإضاءة والظلال ---
function createLight(x, y, radius, color) {
    let g = ctx.createRadialGradient(x, y, 0, x, y, radius);
    g.addColorStop(0, color);
    g.addColorStop(1, 'transparent');
    ctx.fillStyle = g;
    ctx.globalCompositeOperation = 'screen';
    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI*2);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
}

// --- الكائن (The Ghost Ultra) ---
const ghost = {
    x: w/2, y: h-200, vx: 0, vy: 0,
    dir: 1, isJumping: false,
    color: '#fff',
    swordAngle: 0
};

// --- رسم البيئة (الطبقات المتعددة) ---
const stars = Array.from({length: 100}, () => ({x: Math.random()*w, y: Math.random()*h, s: Math.random()*2}));
const trees = Array.from({length: 8}, (_, i) => ({x: i * 300, h: 300 + Math.random()*200}));

function drawWorld() {
    // الطبقة 1: النجوم والبعيد
    ctx.fillStyle = "rgba(255,255,255,0.5)";
    stars.forEach(s => {
        ctx.beginPath();
        ctx.arc((s.x - ghost.x*0.1 + w)%w, s.y, s.s, 0, Math.PI*2);
        ctx.fill();
    });

    // الطبقة 2: أشجار الفراغ (Void Trees)
    ctx.fillStyle = "#05050a";
    trees.forEach(t => {
        let tx = (t.x - ghost.x*0.4 + w*2)% (w + 400) - 200;
        ctx.beginPath();
        ctx.moveTo(tx, h);
        ctx.lineTo(tx + 20, h - t.h);
        ctx.lineTo(tx + 80, h);
        ctx.fill();
    });

    // الأرضية مع انعكاس ضوئي
    ctx.fillStyle = "#020205";
    ctx.fillRect(0, h-100, w, 100);
}

function drawGhost() {
    ctx.save();
    ctx.translate(ghost.x, ghost.y);
    
    // أنيميشن الحركة
    let walkCycle = Math.sin(frame * 0.15) * 5;
    let jumpY = ghost.vy * 2;
    ctx.scale(ghost.dir, 1);

    // 1. العباءة (Advanced Physics)
    ctx.fillStyle = "#111118";
    ctx.beginPath();
    ctx.moveTo(-25, 10);
    for(let i=0; i<=4; i++) {
        let x = -25 + i*12.5;
        let y = 65 + Math.sin(frame*0.1 + i)*8 + Math.abs(ghost.vx)*2;
        ctx.lineTo(x, y);
    }
    ctx.lineTo(25, 10);
    ctx.fill();

    // 2. السيف (The Luminescent Nail)
    ctx.save();
    ghost.swordAngle = Math.abs(ghost.vx) * 0.05 + Math.sin(frame*0.05)*0.1;
    ctx.rotate(ghost.swordAngle);
    // إضاءة السيف
    createLight(40, 0, 80, 'rgba(0, 255, 255, 0.2)');
    ctx.strokeStyle = "#0ff";
    ctx.lineWidth = 4;
    ctx.lineCap = 'round';
    ctx.beginPath(); ctx.moveTo(10, 5); ctx.lineTo(50, -5); ctx.stroke();
    ctx.strokeStyle = "#fff"; ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(10, 5); ctx.lineTo(50, -5); ctx.stroke();
    ctx.restore();

    // 3. الماسك (High Definition Mask)
    let maskGrd = ctx.createLinearGradient(0, -40, 0, 10);
    maskGrd.addColorStop(0, "#fff");
    maskGrd.addColorStop(1, "#99a");
    ctx.fillStyle = maskGrd;
    ctx.beginPath();
    ctx.ellipse(0, -15 + walkCycle/2, 24, 30, 0, 0, Math.PI*2);
    ctx.fill();

    // القرون
    ctx.beginPath();
    ctx.moveTo(-12, -35 + walkCycle/2);
    ctx.quadraticCurveTo(-30, -70, -10, -50);
    ctx.moveTo(12, -35 + walkCycle/2);
    ctx.quadraticCurveTo(30, -70, 10, -50);
    ctx.fill();

    // العيون (The Void)
    ctx.fillStyle = "#000";
    ctx.beginPath(); ctx.ellipse(-8, -15 + walkCycle/2, 6, 10, 0.1, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.ellipse(8, -15 + walkCycle/2, 6, 10, -0.1, 0, Math.PI*2); ctx.fill();

    ctx.restore();
}

function loop() {
    ctx.clearRect(0, 0, w, h);
    
    drawWorld();
    
    // إضاءة تتبع الشخصية
    createLight(ghost.x, ghost.y - 20, 300, 'rgba(100, 150, 255, 0.15)');
    
    drawGhost();

    // الفيزياء
    ghost.vy += 0.8;
    ghost.y += ghost.vy;
    ghost.x += ghost.vx;

    if(ghost.y > h - 150) { ghost.y = h - 150; ghost.vy = 0; ghost.isJumping = false; }

    if(keys.ArrowRight || keys.KeyD) { ghost.vx = 6; ghost.dir = 1; }
    else if(keys.ArrowLeft || keys.KeyA) { ghost.vx = -6; ghost.dir = -1; }
    else { ghost.vx *= 0.8; }

    frame++;
    requestAnimationFrame(loop);
}

window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;
window.onkeydown = e => {
    keys[e.code] = true;
    if(e.code === 'Space' && !ghost.isJumping) { ghost.vy = -18; ghost.isJumping = true; }
};

loop();
</script>
</body>
</html>
