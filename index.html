<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>الهروب من مدينة النيون</title>
    <style>
        body { margin: 0; overflow: hidden; background: #0a0a0a; font-family: 'Courier New', Courier, monospace; }
        canvas { display: block; }
        #ui {
            position: absolute; top: 20px; left: 20px; color: #0ff;
            font-size: 20px; text-shadow: 0 0 5px #0ff;
        }
        #story-box {
            position: absolute; bottom: 30px; width: 100%; text-align: center;
            color: #fff; font-size: 18px; background: rgba(0,0,0,0.6); padding: 10px 0;
        }
    </style>
</head>
<body>

    <div id="ui">الطاقة المتبقية: <span id="score">0</span>%</div>
    <div id="story-box">المهمة: اهرب من المصنع.. اضغط على المسافة (Space) للقفز!</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const storyEl = document.getElementById('story-box');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- إعدادات الشخصية ---
        let player = {
            x: 100, y: canvas.height / 2,
            width: 40, height: 40,
            gravity: 0.6, lift: -12, velocity: 0
        };

        let obstacles = [];
        let score = 0;
        let frame = 0;
        let gameActive = true;

        // قصة تفاعلية على حسب السكور
        const updates = {
            20: "لقد تجاوزت المنطقة الأمنية.. استمر!",
            50: "أنت الآن في أنابيب التهوية، الضوء يقترب!",
            80: "النظام ينهار! اهرب بسرعة!",
            100: "لقد فعلتها! مرحبا بك في العالم الخارجي."
        };

        function drawPlayer() {
            ctx.fillStyle = '#0ff';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#0ff';
            ctx.fillRect(player.x, player.y, player.width, player.height);
            ctx.shadowBlur = 0;
        }

        function createObstacle() {
            let gap = 200;
            let topHeight = Math.random() * (canvas.height / 2);
            obstacles.push({
                x: canvas.width,
                top: topHeight,
                bottom: canvas.height - (topHeight + gap),
                width: 50
            });
