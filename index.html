<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>The Infinite Doll - Final Code</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050208; }
        canvas { display: block; filter: contrast(1.1) saturate(1.3); }
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, transparent, rgba(0,0,0,0.4));
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <canvas id="c"></canvas>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let w, h;
const setSize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; };
window.onresize = setSize; setSize();

let frame = 0;

// --- نظام رسم الأجزاء المعقدة ---
function drawPath(points, color, close = true) {
    ctx.beginPath();
    ctx.fillStyle = color;
    ctx.moveTo(points[0].x, points[0].y);
    for (let i = 1; i < points.length; i++) {
        ctx.lineTo(points[i].x, points[i].y);
    }
    if (close) ctx.closePath();
    ctx.fill();
}

function drawFinalCharacter() {
    let t = frame * 0.05;
    let breathe = Math.sin(t) * 4;
    let sway = Math.sin(t * 0.5) * 3;

    ctx.save();
    ctx.translate(w/2, h/2 + 100);

    // 1. الأرجل والحذاء (التفاصيل الدقيقة)
    const drawLeg = (ox, sockColor, dots = false) => {
        ctx.save();
        ctx.translate(ox, 0);
        // الساق
        ctx.fillStyle = "#fff5f0";
        ctx.fillRect(-8, 0, 16, 80);
        // الجورب
        ctx.fillStyle = sockColor;
        ctx.fillRect(-9, 40, 18, 50);
        if(dots) { // الجورب المنقط
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            for(let i=0; i<3; i++) ctx.beginPath(), ctx.arc(0, 50 + i*15, 3, 0, 7), ctx.fill();
        }
        // الحذاء الضخم
        ctx.fillStyle = "#1a1a1a";
        ctx.beginPath();
        ctx.roundRect(-15, 90, 35, 25, 10);
        ctx.fill();
        ctx.restore();
    };
    drawLeg(-25, "#d8b4fe", true); // اليمين
    drawLeg(15, "#ffffff", false); // اليسار

    // 2. الفستان الوردي (Layered Skirt)
    ctx.save();
    ctx.translate(0, breathe);
    ctx.rotate(sway * 0.01);
    
    // الفستان
    ctx.fillStyle = "#fbcfe8";
    ctx.beginPath();
    ctx.moveTo(-50, -40);
    ctx.bezierCurveTo(-90, 80, 90, 80, 50, -40);
    ctx.fill();
    // حدود سوداء رقيقة (بحال صورتك)
    ctx.lineWidth = 2; ctx.strokeStyle = "#401020"; ctx.stroke();

    // العيون التصميمية فالفستان
    const drawDressEye = (ex, ey) => {
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.ellipse(ex, ey, 12, 18, 0, 0, 7); ctx.fill();
        ctx.fillStyle = "#000";
        ctx.beginPath(); ctx.arc(ex, ey, 6, 0, 7); ctx.fill();
    };
    drawDressEye(-35, 35); drawDressEye(35, 35);
    ctx.restore();

    // 3. الجزء العلوي (Jacket & Sleeves)
    ctx.save();
    ctx.translate(0, -50 + breathe * 0.5);
    // الأكمام المنفوخة
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.ellipse(-50, 0, 18, 25, 0.4, 0, 7); ctx.fill();
    ctx.beginPath(); ctx.ellipse(50, 0, 18, 25, -0.4, 0, 7); ctx.fill();
    // السترة البنفسجية
    ctx.fillStyle = "#701a75";
    ctx.beginPath();
    ctx.moveTo(-40, -20); ctx.lineTo(40, -20);
    ctx.lineTo(50, 30); ctx.lineTo(-50, 30);
    ctx.closePath(); ctx.fill();
    ctx.restore();

    // 4. الرأس (التحفة الفنية)
    ctx.save();
    ctx.translate(0, -110 + breathe * 0.3);
    
    // الشعر الأزرق (خصلات متحركة)
    ctx.fillStyle = "#93c5fd";
    ctx.beginPath();
    ctx.moveTo(-70, 0);
    ctx.bezierCurveTo(-90, -120, 90, -120, 70, 0);
    // خصلات الشعر الجانبية
    for(let i=0; i<6; i++) {
        let hsway = Math.sin(t + i) * 5;
        ctx.quadraticCurveTo(80 + hsway, -20 + i*15, 60, 40);
    }
    ctx.fill();

    // الوجه
    ctx.fillStyle = "#fff5f0";
    ctx.beginPath(); ctx.ellipse(0, -15, 55, 50, 0, 0, 7); ctx.fill();

    // العيون الكبيرة (High Detail)
    const drawEye = (ex) => {
        ctx.save(); ctx.translate(ex, -20);
        // بياض العين
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.ellipse(0, 0, 18, 22, 0, 0, 7); ctx.fill();
        // البؤبؤ الأزرق المتدرج
        let eg = ctx.createRadialGradient(0,0,0,0,0,15);
        eg.addColorStop(0, "#60a5fa"); eg.addColorStop(1, "#1d4ed8");
        ctx.fillStyle = eg;
        ctx.beginPath(); ctx.ellipse(0, 0, 12, 16, 0, 0, 7); ctx.fill();
        // لمعة العين (Sparkle)
        ctx.fillStyle = "#fff";
        ctx.beginPath(); ctx.arc(-5, -8, 4, 0, 7); ctx.fill();
        ctx.restore();
    };
    drawEye(-22); drawEye(22);

    // النجوم الذهبية
    ctx.fillStyle = "#fbbf24";
    const star = (sx, sy) => {
        ctx.beginPath(); for(let i=0; i<5; i++) ctx.lineTo(sx+Math.cos(i*1.26)*10, sy+Math.sin(i*1.26)*10); ctx.closePath(); ctx.fill();
    };
    star(-55, 10); star(55, 10);

    // 5. القبعة الأسطورية (The Top Hat)
    ctx.save();
    ctx.rotate(-0.15 + Math.sin(t)*0.05);
    ctx.translate(0, -85);
    ctx.fillStyle = "#581c87";
    ctx.fillRect(-40, 0, 80, 50); // جسم القبعة
    ctx.fillStyle = "#fbbf24"; ctx.fillRect(-40, 35, 80, 10); // الشريط
    ctx.fillStyle = "#581c87"; ctx.beginPath(); ctx.roundRect(-55, 45, 110, 12, 5); ctx.fill(); // القاعدة
    ctx.restore();

    ctx.restore();
    ctx.restore();
}

function anim() {
    ctx.clearRect(0, 0, w, h);
    
    // إضاءة خلفية ناعمة
    let bgGrd = ctx.createRadialGradient(w/2, h/2, 0, w/2, h/2, w);
    bgGrd.addColorStop(0, "#1a0b2e"); bgGrd.addColorStop(1, "#050208");
    ctx.fillStyle = bgGrd;
    ctx.fillRect(0,0,w,h);

    drawFinalCharacter();
    frame++;
    requestAnimationFrame(anim);
}
anim();
</script>
</body>
</html>
