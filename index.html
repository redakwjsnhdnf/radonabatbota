<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>NEON RAZOR: THE AWAKENING</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Courier New', monospace; }
        canvas { display: block; filter: contrast(1.2) brightness(1.1); }
        #overlay {
            position: absolute; top: 20px; left: 20px; color: #0ff;
            text-shadow: 0 0 10px #0ff; pointer-events: none;
        }
        .stats { font-size: 18px; margin-bottom: 5px; }
        #dialogue {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 80%; background: rgba(0, 0, 0, 0.8); border: 2px solid #0ff;
            color: #fff; padding: 20px; display: none; text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }
    </style>
</head>
<body>

    <div id="overlay">
        <div class="stats">SYSTEM: NEON_RAZOR_v1.0</div>
        <div class="stats">الطاقة: <span id="health">100</span>%</div>
        <div class="stats">المسافة: <span id="dist">0</span>m</div>
    </div>

    <div id="dialogue"></div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const healthEl = document.getElementById('health');
        const distEl = document.getElementById('dist');
        const diagEl = document.getElementById('dialogue');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- نظام الحالة والقصة ---
        let state = {
            gameActive: true,
            distance: 0,
            health: 100,
            frame: 0,
            shake: 0,
            storyStep: 0
        };

        const story = [
            "الآلي Z-100.. استيقظ.. لقد سيطر النظام على المدينة.",
            "استخدم [Space] للقفز و [Shift] للاندفاع السريع (DASH).",
            "طاقتك تتناقص.. اجمع ذرات النيون للبقاء حياً.",
            "أنت الآن في قلب القطاع السفلـي.. المخرج قريب!"
        ];

        // --- نظام الجزيئات (GFX) ---
        let particles = [];
        function createParticle(x, y, color) {
            for(let i=0; i<8; i++) {
                particles.push({
                    x, y, 
                    vx: (Math.random()-0.5)*10, 
                    vy: (Math.random()-0.5)*10,
                    life: 1.0,
                    color
                });
            }
        }

        // --- الكائنات ---
        let player = {
            x: 100, y: 0, w: 40, h: 60,
            vy: 0, gravity: 0.8, jump: -16,
            isJumping: false, dashing: 0,
            dashCooldown: 0
        };

        let obstacles = [];
        let clouds = []; // سحب نيون في الخلفية

        // توليد خلفية المدينة برمجياً
        function drawCityscape() {
            ctx.fillStyle = "#0a0a15";
            for(let i=0; i<10; i++) {
                let h = 200 + Math.sin(i + state.frame*0.01)*50;
                ctx.globalAlpha = 0.3;
                ctx.fillRect(i*200 - (state.distance%200), canvas.height - h, 150, h);
            }
            ctx.globalAlpha = 1.0;
        }

        function drawPlayer() {
            ctx.save();
            if(state.shake > 0) ctx.translate(Math.random()*5, Math.random()*5);
            
            // تأثير الظل عند الـ Dash
            if(player.dashing > 0) {
                ctx.globalAlpha = 0.5;
                ctx.fillStyle = "#f0f";
                ctx.fillRect(player.x - 20, player.y, player.w, player.h);
            }

            // رسم الشخصية (Samurai Robot)
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#0ff";
            ctx.fillStyle = "#0ff";
            ctx.fillRect(player.x, player.y, player.w, player.h); // الجسم
            
            ctx.fillStyle = "#fff";
            ctx.fillRect(player.x + 25, player.y + 10, 15, 5); // العين المضيئة
            
            // سيف النيون
            ctx.strokeStyle = "#f0f";
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(player.x + 20, player.y + 40);
            ctx.lineTo(player.x + 50 + (player.dashing*2), player.y + 10);
            ctx.stroke();
            
            ctx.restore();
        }

        function spawnObstacle() {
            if(state.frame % 80 === 0) {
                obstacles.push({
                    x: canvas.width,
                    y: canvas.height - 100,
                    w: 40, h: 80,
                    type: Math.random() > 0.5 ? 'laser' : 'drone'
                });
            }
        }

        function update() {
            if(!state.gameActive) return;

            // فيزياء اللاعب
            player.vy += player.gravity;
            player.y += player.vy;
            if(player.y + player.h > canvas.height - 20) {
                player.y = canvas.height - 20 - player.h;
                player.isJumping = false;
            }

            if(player.dashing > 0) player.dashing--;
            if(player.dashCooldown > 0) player.dashCooldown--;

            // تحديث العوائق
            obstacles.forEach((obs, i) => {
                obs.x -= (8 + state.distance/500); // السرعة تزداد مع الوقت
                
                // اصطدام
                if(player.x < obs.x + obs.w && player.x + player.w > obs.x &&
                   player.y < obs.y + obs.h && player.y + player.h > obs.y) {
                    if(player.dashing > 0) {
                        // كسر العائق أثناء الـ Dash
                        createParticle(obs.x, obs.y, "#ff0");
                        obstacles.splice(i, 1);
                        state.distance += 50;
                    } else {
                        state.health -= 20;
                        state.shake = 10;
                        obstacles.splice(i, 1);
                        if(state.health <= 0) endGame();
                    }
                }
            });

            // الجزيئات
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                if(p.life <= 0) particles.splice(i, 1);
            });

            state.distance++;
            state.frame++;
            if(state.shake > 0) state.shake--;

            // القصة
            if(state.distance % 300 === 0 && story[state.storyStep]) {
                showDialogue(story[state.storyStep]);
                state.storyStep++;
            }
        }

        function draw() {
            ctx.fillStyle = "#050510";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawCityscape();

            // الأرضية النيون
            ctx.strokeStyle = "#0ff";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height - 20);
            ctx.lineTo(canvas.width, canvas.height - 20);
            ctx.stroke();

            // رسم الجزيئات
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
            });
            ctx.globalAlpha = 1;

            // رسم العوائق
            obstacles.forEach(obs => {
                ctx.fillStyle = obs.type === 'laser' ? "#f00" : "#ff0";
                ctx.shadowBlur = 15;
                ctx.shadowColor = ctx.fillStyle;
                ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
            });

            drawPlayer();
            update();
            spawnObstacle();

            healthEl.innerText = state.health;
            distEl.innerText = Math.floor(state.distance/10);

            requestAnimationFrame(draw);
        }

        function showDialogue(txt) {
            diagEl.innerText = txt;
            diagEl.style.display = "block";
            setTimeout(() => diagEl.style.display = "none", 4000);
        }

        function endGame() {
            state.gameActive = false;
            diagEl.style.display = "block";
            diagEl.innerHTML = "<h1 style='color:red'>فشل النظام</h1> المسافة المقطوعة: " + Math.floor(state.distance/10) + " متر<br>اضغط F5 للمحاولة مجدداً";
        }

        // التحكم
        window.addEventListener('keydown', (e) => {
            if(e.code === 'Space' && !player.isJumping) {
                player.vy = player.jump;
                player.isJumping = true;
                createParticle(player.x, player.y + player.h, "#0ff");
            }
            if((e.code === 'ShiftLeft' || e.code === 'ShiftRight') && player.dashCooldown === 0) {
                player.dashing = 15;
                player.dashCooldown = 60;
                createParticle(player.x, player.y, "#f0f");
            }
        });

        // تشغيل البداية
        showDialogue("بدء تشغيل النظام... مرحباً بك في مدينة النيون.");
        draw();

    </script>
</body>
</html>
