<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radona Batbota | Secret Vault</title>
    <style>
        body { background: #000; color: #0f0; font-family: 'Courier New', monospace; padding: 20px; text-align: center; }
        .box { border: 2px solid #0f0; padding: 20px; border-radius: 10px; max-width: 600px; margin: 20px auto; box-shadow: 0 0 15px #0f0; }
        textarea { width: 90%; height: 80px; background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 10px 0; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: #fff; box-shadow: 0 0 20px #fff; }
        canvas { display: none; }
        #outputImg { max-width: 100%; margin-top: 20px; border: 1px solid #fff; display: none; }
        .tab { display: flex; justify-content: space-around; margin-bottom: 20px; }
        .tab-btn { background: none; color: #0f0; border: 1px solid #0f0; width: 45%; }
        .active { background: #0f0; color: #000; }
    </style>
</head>
<body>

    <h1>[ RADONA-STEGANO-V1 ]</h1>

    <div class="box">
        <div class="tab">
            <button class="tab-btn active" onclick="showTab('encode')">تشفير (إخفاء)</button>
            <button class="tab-btn" onclick="showTab('decode')">فك التشفير (إظهار)</button>
        </div>

        <div id="encodeSection">
            <input type="file" id="upload" accept="image/*"><br>
            <textarea id="message" placeholder="اكتب السر هنا..."></textarea><br>
            <button onclick="encode()">توليد الصورة المشفرة</button>
            <img id="outputImg">
        </div>

        <div id="decodeSection" style="display:none;">
            <p>ارفع الصورة التي استلمتها لرؤية السر:</p>
            <input type="file" id="uploadDecode" accept="image/*"><br><br>
            <button onclick="decode()">كشف السر المحتجب</button>
            <div id="decodedMessage" style="margin-top:20px; font-size: 1.5em; color: yellow;"></div>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        function showTab(type) {
            document.getElementById('encodeSection').style.display = type === 'encode' ? 'block' : 'none';
            document.getElementById('decodeSection').style.display = type === 'decode' ? 'block' : 'none';
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active'));
        }

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function encode() {
            const file = document.getElementById('upload').files[0];
            const msg = document.getElementById('message').value;
            if(!file || !msg) return alert("أدخل الصورة والرسالة أولاً!");

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width; canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const binaryMsg = Array.from(new TextEncoder().encode(msg + "##END##")).map(b => b.toString(2).padStart(8, '0')).join('');
                    
                    for (let i = 0; i < binaryMsg.length; i++) {
                        imgData.data[i * 4] = (imgData.data[i * 4] & 0xFE) | parseInt(binaryMsg[i]);
                    }
                    ctx.putImageData(imgData, 0, 0);
                    const out = document.getElementById('outputImg');
                    out.src = canvas.toDataURL();
                    out.style.display = "block";
                    alert("تم التشفير! اضغط مطولاً على الصورة لحفظها.");
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function decode() {
            const file = document.getElementById('uploadDecode').files[0];
            if(!file) return alert("ارفع الصورة أولاً!");

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width; canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    let binary = "";
                    for (let i = 0; i < imgData.data.length / 4; i++) {
                        binary += (imgData.data[i * 4] & 1).toString();
                    }
                    const bytes = binary.match(/.{1,8}/g).map(b => parseInt(b, 2));
                    const decoded = new TextDecoder().decode(new Uint8Array(bytes));
                    const result = decoded.split("##END##")[0];
                    document.getElementById('decodedMessage').innerText = "الرسالة السرية: " + result;
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
