<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>REDA CRAFT v1.0</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid white; transform: translate(-50%, -50%); pointer-events: none; }
        #inventory { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; color: white; display: flex; gap: 10px; }
        .slot { width: 40px; height: 40px; border: 2px solid #555; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .selected { border-color: #00ff00; background: rgba(0,255,0,0.2); }
        #instructions { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; }
    </style>
</head>
<body>
    <div id="crosshair"></div>
    <div id="instructions">
        W,A,S,D: حركة | Space: قفز | Left Click: حفر | Right Click: بناء | 1-3: اختيار البلوكة
    </div>
    <div id="inventory">
        <div id="slot1" class="slot selected">Grass</div>
        <div id="slot2" class="slot">Dirt</div>
        <div id="slot3" class="slot">Stone</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        let blocks = [], currentBlockType = 0x228B22; // Grass

        const blockTypes = [0x228B22, 0x8B4513, 0x808080]; // Grass, Dirt, Stone

        window.onload = () => {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const sun = new THREE.DirectionalLight(0xffffff, 0.8);
            sun.position.set(10, 20, 10);
            scene.add(sun);

            // توليد عالم بسيط (Flat World)
            for(let x = -10; x < 10; x++) {
                for(let z = -10; z < 10; z++) {
                    createBlock(x, 0, z, 0x228B22);
                }
            }

            camera.position.y = 2;

            // التحكم بالفأرة (Pointer Lock)
            document.body.addEventListener('click', () => {
                document.body.requestPointerLock();
            });

            document.addEventListener('mousemove', (e) => {
                if (document.pointerLockElement === document.body) {
                    camera.rotation.y -= e.movementX * 0.002;
                    camera.rotation.x -= e.movementY * 0.002;
                    camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
                }
            });

            // الحفر والبناء
            window.onmousedown = (e) => {
                if (document.pointerLockElement !== document.body) return;
                
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera({x: 0, y: 0}, camera);
                const intersects = raycaster.intersectObjects(blocks);

                if (intersects.length > 0) {
                    const intersect = intersects[0];
                    if (e.button === 0) { // حفر (Left Click)
                        scene.remove(intersect.object);
                        blocks = blocks.filter(b => b !== intersect.object);
                    } else if (e.button === 2) { // بناء (Right Click)
                        const pos = intersect.object.position.clone().add(intersect.face.normal);
                        createBlock(pos.x, pos.y, pos.z, currentBlockType);
                    }
                }
            };

            window.oncontextmenu = (e) => e.preventDefault(); // منع القائمة اليمنى

            // لوحة المفاتيح
            window.onkeydown = (e) => {
                if(e.code === 'KeyW') moveForward = true;
                if(e.code === 'KeyS') moveBackward = true;
                if(e.code === 'KeyA') moveLeft = true;
                if(e.code === 'KeyD') moveRight = true;
                if(e.code === 'Space' && canJump) { velocity.y += 5; canJump = false; }
                if(e.key === '1') selectSlot(0);
                if(e.key === '2') selectSlot(1);
                if(e.key === '3') selectSlot(2);
            };
            window.onkeyup = (e) => {
                if(e.code === 'KeyW') moveForward = false;
                if(e.code === 'KeyS') moveBackward = false;
                if(e.code === 'KeyA') moveLeft = false;
                if(e.code === 'KeyD') moveRight = false;
            };

            function createBlock(x, y, z, color) {
                const geo = new THREE.BoxGeometry(1, 1, 1);
                const mat = new THREE.MeshPhongMaterial({color: color});
                const cube = new THREE.Mesh(geo, mat);
                cube.position.set(x, y, z);
                scene.add(cube);
                blocks.push(cube);
            }

            function selectSlot(i) {
                currentBlockType = blockTypes[i];
                document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
                document.getElementById('slot' + (i+1)).classList.add('selected');
            }

            function animate() {
                requestAnimationFrame(animate);
                
                // فيزياء الحركة
                velocity.y -= 0.2; // جاذبية
                camera.position.y += velocity.y * 0.01;
                
                if(camera.position.y <= 2) {
                    camera.position.y = 2;
                    velocity.y = 0;
                    canJump = true;
                }

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();

                if (moveForward || moveBackward) camera.translateZ(-direction.z * 0.1);
                if (moveLeft || moveRight) camera.translateX(direction.x * 0.1);

                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
